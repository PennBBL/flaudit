---
title: "FLAUDIT: Flywheel Project Audit"
output: html_notebook
---

```{r}
library(tidyverse)
```


Read in data:

```{r}
attachments <- read_csv("data/attachments.csv")
seqinfo <- read_csv("data/seqinfo.csv")
jobs <- read_csv("data/jobs.csv")
```

# Sequences & Missingness

Here's a list of all the sequences in this project:

```{r}
sequences <- seqinfo %>%
  pull(series_description) %>%
  unique() %>%
  sort()

cat(sequences, sep = "\n")
```

Below we visualise how these sequences are spread amongst the participants:

```{r}
find_missingness <- function(seqinfo){
  
  sequences <- seqinfo %>%
    pull(series_description) %>%
    unique() %>%
    sort()
  
  subjects <- seqinfo %>%
    pull(patient_id) %>%
    unique() %>%
    sort()
  
  plot_table <- data.frame()
  
  for(s in sequences){
    
    present <- seqinfo %>%
      filter(str_detect(series_description, s)) %>%
      pull(patient_id) %>%
      unique()
    
    plot_table <- subjects %in% present %>%
      table() %>%
      prop.table() %>%
      as.data.frame() %>%
      cbind(s, .) %>%
      rename(., 'present' = `.`) %>%
      rbind(plot_table, .)
      
  }
  
  return(plot_table)
}

find_missingness(seqinfo) %>%
  mutate(Freq = Freq *100) %>%
  ggplot(aes(x=s, y=Freq)) +
  geom_col(position = 'stack', aes(fill = present)) +
  theme_minimal() +
  scale_fill_viridis_d() +
  coord_flip() #+
  #theme(axis.text.x = element_text(angle = 45, hjust = 1))
```

